<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SF6 Dojo</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  background: linear-gradient(135deg, #0f1115, #1a1c22);
  color: #fff;
  font-family: 'Inter', sans-serif;
  margin: 0;
  padding: 40px 20px;
  min-height: 100vh;
}
h1 {
  text-align: center;
  margin: 0 0 40px 0;
  font-weight: 600;
  font-size: 2.5em;
  color: #00baff;
  text-shadow: 0 0 12px rgba(0,186,255,0.7);
}
#back-home {
  position: fixed;
  top: 20px;
  left: 20px;
  background: #00baff;
  color: #0f1115;
  padding: 12px 24px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 600;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0,186,255,0.4);
  z-index: 100;
}
#back-home:hover {
  background: #00ffe6;
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0,186,255,0.6);
}
#filters {
  max-width: 1400px;
  margin: 0 auto 40px auto;
  padding: 0 20px;
  display: flex;
  flex-wrap: wrap;
  gap: 16px;
  justify-content: center;
  align-items: center;
}
.filter-group {
  display: flex;
  gap: 8px;
  align-items: center;
}
.filter-label {
  color: #aaa;
  font-size: 0.9em;
  font-weight: 600;
}
.filter-btn {
  background: #1e2028;
  color: #00baff;
  border: 2px solid #00baff;
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.9em;
  transition: all 0.2s ease;
}
.filter-btn:hover {
  background: #00baff;
  color: #0f1115;
}
.filter-btn.active {
  background: #00baff;
  color: #0f1115;
  box-shadow: 0 0 12px rgba(0,186,255,0.5);
}
.clear-filters {
  background: #ff4444;
  border-color: #ff4444;
  color: #fff;
}
.clear-filters:hover {
  background: #ff6666;
  border-color: #ff6666;
}
#gallery {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
  gap: 32px;
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 20px;
}
.video-wrapper {
  background: #1e2028;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 8px 24px rgba(0,0,0,0.5);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.video-wrapper:hover {
  transform: translateY(-8px);
  box-shadow: 0 16px 40px rgba(0,186,255,0.3);
}
.video-label {
  text-align: center;
  padding: 20px 20px 16px 20px;
  font-size: 1.15em;
  color: #00baff;
  cursor: pointer;
  font-weight: 600;
  text-decoration: none;
  transition: color 0.2s ease;
}
.video-label:hover {
  color: #00ffe6;
}
.video-container {
  position: relative;
  width: 100%;
  padding-bottom: 56.25%;
  background: #000;
}
.video-container iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: none;
}
.info {
  text-align: center;
  padding: 16px 20px 20px 20px;
  font-size: 0.9em;
  color: #aaa;
}
body.single-video {
  padding: 80px 20px 20px 20px;
}
body.single-video h1 { display: none; }
body.single-video #filters { display: none; }
body.single-video #gallery {
  grid-template-columns: 1fr;
  max-width: 1200px;
  padding: 0;
}
body.single-video .video-container {
  padding-bottom: 56.25%;
}
@media (max-width: 768px) {
  #gallery {
    grid-template-columns: 1fr;
    gap: 24px;
    padding: 0 10px;
  }
  h1 {
    font-size: 2em;
    margin-bottom: 30px;
  }
  #filters {
    flex-direction: column;
    gap: 12px;
  }
  #back-home {
    top: 10px;
    left: 10px;
    padding: 10px 16px;
    font-size: 0.9em;
  }
}
</style>
</head>
<body>

<a href="?" id="back-home" style="display:none;">‚Üê Home</a>

<h1>SF6 Dojo</h1>

<div id="filters">
  <div class="filter-group">
    <span class="filter-label">Player:</span>
    <div id="player-filters"></div>
  </div>
  <div class="filter-group">
    <span class="filter-label">Opponent:</span>
    <div id="opponent-filters"></div>
  </div>
  <div class="filter-group">
    <span class="filter-label">Control:</span>
    <button class="filter-btn" data-control="M">Modern</button>
    <button class="filter-btn" data-control="C">Classic</button>
  </div>
  <div class="filter-group">
    <span class="filter-label">Result:</span>
    <button class="filter-btn" data-result="W">Win</button>
    <button class="filter-btn" data-result="L">Loss</button>
  </div>
  <button class="filter-btn clear-filters" id="clear-filters">Clear Filters</button>
</div>

<div id="gallery"></div>

<script>
const gallery = document.getElementById('gallery');
const baseUrl = window.location.origin + window.location.pathname;
const params = new URLSearchParams(window.location.search);
const videoParam = params.get('video');

let allVideos = [];
let activeFilters = {
  player: null,
  opponent: null,
  control: null,
  result: null
};

if (videoParam) {
  document.body.classList.add('single-video');
  document.getElementById('back-home').style.display = 'block';
}

function parseVideoTitle(title) {
  const playerMatch = title.match(/^([^\s]+)\s+VS/);
  const vsMatch = title.match(/VS\s+([^\s\[]+)/);
  const controlMatch = title.match(/\[([MC])\]/);
  const resultMatch = title.match(/\s([WL])\)/);
  
  return {
    player: playerMatch ? playerMatch[1] : null,
    opponent: vsMatch ? vsMatch[1] : null,
    control: controlMatch ? controlMatch[1] : null,
    result: resultMatch ? resultMatch[1] : null
  };
}

function applyFilters() {
  const filtered = allVideos.filter(video => {
    if (activeFilters.player && video.player !== activeFilters.player) return false;
    if (activeFilters.opponent && video.opponent !== activeFilters.opponent) return false;
    if (activeFilters.control && video.control !== activeFilters.control) return false;
    if (activeFilters.result && video.result !== activeFilters.result) return false;
    return true;
  });
  
  renderVideos(filtered);
}

function renderVideos(videos) {
  gallery.innerHTML = '';
  
  if (videos.length === 0) {
    gallery.innerHTML = '<p style="text-align:center;color:#aaa;grid-column:1/-1;">No videos match the selected filters</p>';
    return;
  }
  
  videos.forEach(video => {
    const wrapper = document.createElement('div');
    wrapper.className = 'video-wrapper';

    const label = document.createElement('div');
    label.className = 'video-label';
    label.textContent = video.title;

    label.addEventListener('click', (e) => {
      e.stopPropagation();
      const fullLink = `${baseUrl}?video=${video.id}`;
      navigator.clipboard.writeText(fullLink)
        .then(() => alert(`Copied link: ${fullLink}`))
        .catch(err => console.error(err));
    });

    wrapper.addEventListener('click', () => {
      window.location.href = `${baseUrl}?video=${video.id}`;
    });

    const container = document.createElement('div');
    container.className = 'video-container';
    container.innerHTML = `<iframe allowfullscreen src="https://streamable.com/e/${video.id}?loop=0"></iframe>`;

    wrapper.appendChild(label);
    wrapper.appendChild(container);

    if (videoParam) {
      const info = document.createElement('div');
      info.className = 'info';
      info.textContent = 'Share this video by clicking the title above';
      wrapper.appendChild(info);
    }

    gallery.appendChild(wrapper);
  });
}

fetch('videos.txt')
  .then(res => res.text())
  .then(text => {
    const lines = text.split('\n').filter(l => l.trim() !== '');
    const players = new Set();
    const opponents = new Set();

    lines.forEach(line => {
      const [title, link] = line.split('|').map(s => s.trim());
      if (!title || !link) return;

      const match = link.match(/streamable\.com\/(?:e\/)?([a-zA-Z0-9]+)/);
      if (!match) return;
      const videoID = match[1];

      const parsed = parseVideoTitle(title);
      
      const video = {
        id: videoID,
        title: title,
        player: parsed.player,
        opponent: parsed.opponent,
        control: parsed.control,
        result: parsed.result
      };

      if (parsed.player) players.add(parsed.player);
      if (parsed.opponent) opponents.add(parsed.opponent);

      if (videoParam && videoParam !== videoID) return;
      
      allVideos.push(video);
    });

    // Create player filter buttons
    const playerFilters = document.getElementById('player-filters');
    Array.from(players).sort().forEach(player => {
      const btn = document.createElement('button');
      btn.className = 'filter-btn';
      btn.textContent = player;
      btn.dataset.player = player;
      btn.addEventListener('click', () => {
        document.querySelectorAll('[data-player]').forEach(b => b.classList.remove('active'));
        if (activeFilters.player === player) {
          activeFilters.player = null;
        } else {
          activeFilters.player = player;
          btn.classList.add('active');
        }
        applyFilters();
      });
      playerFilters.appendChild(btn);
    });

    // Create opponent filter buttons
    const opponentFilters = document.getElementById('opponent-filters');
    Array.from(opponents).sort().forEach(opponent => {
      const btn = document.createElement('button');
      btn.className = 'filter-btn';
      btn.textContent = opponent;
      btn.dataset.opponent = opponent;
      btn.addEventListener('click', () => {
        document.querySelectorAll('[data-opponent]').forEach(b => b.classList.remove('active'));
        if (activeFilters.opponent === opponent) {
          activeFilters.opponent = null;
        } else {
          activeFilters.opponent = opponent;
          btn.classList.add('active');
        }
        applyFilters();
      });
      opponentFilters.appendChild(btn);
    });

    // Control filter handlers
    document.querySelectorAll('[data-control]').forEach(btn => {
      btn.addEventListener('click', () => {
        const control = btn.dataset.control;
        document.querySelectorAll('[data-control]').forEach(b => b.classList.remove('active'));
        if (activeFilters.control === control) {
          activeFilters.control = null;
        } else {
          activeFilters.control = control;
          btn.classList.add('active');
        }
        applyFilters();
      });
    });

    // Result filter handlers
    document.querySelectorAll('[data-result]').forEach(btn => {
      btn.addEventListener('click', () => {
        const result = btn.dataset.result;
        document.querySelectorAll('[data-result]').forEach(b => b.classList.remove('active'));
        if (activeFilters.result === result) {
          activeFilters.result = null;
        } else {
          activeFilters.result = result;
          btn.classList.add('active');
        }
        applyFilters();
      });
    });

    // Clear filters handler
    document.getElementById('clear-filters').addEventListener('click', () => {
      activeFilters = { player: null, opponent: null, control: null, result: null };
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      applyFilters();
    });

    if (videoParam && allVideos.length === 0) {
      gallery.innerHTML = '<p style="text-align:center;color:#f55;">Video not found!</p>';
    } else {
      renderVideos(allVideos);
    }
  })
  .catch(err => console.error(err));
</script>

</body>
</html>
